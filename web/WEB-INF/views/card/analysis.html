<!DOCTYPE HTML
    PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3c.org/TR/1999/REC-html401-19991224/loose.dtd">
<!-- saved from url=(0090)https://cjy.icbc.com.cn/RelSceneService/mp/orderAnalysis -->
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http：//www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<HTML xmlns="http://www.w3.org/1999/xhtml">

<HEAD>
    <META content="IE=11.0000" http-equiv="X-UA-Compatible">
    <TITLE>统计分析</TITLE>
    <META http-equiv="X-UA-Compatible" content="IE=edge">
    <META http-equiv="Content-Type" content="text/html; charset=utf-8">
    <SCRIPT src="../js/jquery-3.2.1.min.js"></SCRIPT>

    <SCRIPT src="../js/orderAnalysis.js"></SCRIPT>
    <SCRIPT src="../js/echarts.min.js"></SCRIPT>
    <SCRIPT src="../css/layui/layui.js"></SCRIPT>
    <LINK href="../css/layui/css/layui.css" rel="stylesheet" media="all">
    <LINK href="../css/common.css" rel="stylesheet" type="text/css">
    <LINK href="../css/orderAnalysis.css" rel="stylesheet" type="text/css">
    
    <META name="GENERATOR" content="MSHTML 11.00.10570.1001">
</HEAD>

<BODY>
    <DIV class="header">
        <DIV class="header_a">
            <DIV class="header_mp"></DIV>
            <DIV class="user"><SPAN>南昌共享雨伞</SPAN></DIV>
        </DIV>
    </DIV>
    <DIV class="content2">
        <DIV class="vbm">
            <DIV class="klkl">
                <DIV class="tttt"></DIV>
                <DIV class="main">
                    <!-- 这里是需要填充的主体内容 -->
                    <DIV class="layui-rows" id="cards">
                        <!--  <div class="layui-col-xs3">
	               <div class="layui-card">
	                 <div class="layui-card-header">累计总访问量</div>
	                 <div class="layui-card-body" id="allaccessNum"></div>
	               </div>       
	           </div>
	         <div class="layui-col-xs3">
	         <div class="layui-card">
	             <div class="layui-card-header">累计访问用户数</div>
	             <div class="layui-card-body" id="accessPersonNum"></div>
	         </div>
	          </div> -->

                        <DIV class="layui-col-xs3">
                            <DIV class="layui-card">
                                <DIV class="layui-card-header">今日已发送</DIV>
                                <DIV class="layui-card-body" id="daySend"></DIV>
                            </DIV>
                        </DIV>
                        <DIV class="layui-col-xs3">
                            <DIV class="layui-card">
                                <DIV class="layui-card-header">今日已查看</DIV>
                                <DIV class="layui-card-body" id="dayView"></DIV>
                            </DIV>
                        </DIV>
                    </DIV>
                    <DIV id="activity-panel">
                        <DIV class="layui-card activity-detail">
                            <DIV class="layui-card-header">贺卡概览</DIV>
                            <DIV class="layui-card-body">
                                <TABLE class="layui-table">
                                    <COLGROUP>
                                        <COL width="150">
                                        <COL width="230">
                                    </COLGROUP>
                                    <TBODY>
                                        <TR>
                                            <TD>贺卡名称</TD>
                                            <TD id="cardName"></TD>
                                        </TR>
                                        <TR>
                                            <TD>贺卡类型</TD>
                                            <TD>生日贺卡</TD>
                                        </TR>
                                        <TR>
                                            <TD>操作</TD>
                                            <TD><BUTTON class="layui-btn" onclick="edit()"
                                                    data-type="reload">贺卡编辑</BUTTON></TD>
                                        </TR>
                                    </TBODY>
                                </TABLE>
                            </DIV>
                        </DIV>
                        <!-- <DIV class="layui-card activity-rule">
                            <DIV class="layui-card-header">订餐规则</DIV>
                            <DIV class="layui-card-body scroll" id="rule"></DIV>
                        </DIV> -->
                    </DIV>
                    <DIV id="visit-panel">
                        <DIV class="layui-card">
                            <DIV class="layui-card-header">本月数据</DIV>
                            <DIV class="layui-card-body">
                                <FORM class="layui-form" id="menu" lay-filter="menu-filter">
                                    <DIV class="tool">
                                        <DIV class="layui-form-item"><LABEL class="layui-form-label">开始日期</LABEL>
                                            <DIV class="layui-input-inline"><INPUT name="dateStr" class="layui-input"
                                                    id="date1"></DIV><BUTTON class="layui-btn" type="button"
                                                lay-filter="queryMenu" lay-submit="">查询</BUTTON>
                                        </DIV>
                                    </DIV>
                                </FORM>
                                <!-- 折线图 -->
                           
                            </DIV>
                        </DIV>
                    </DIV>
                    <DIV class="data-panel">
                        <DIV class="layui-card">
                            <DIV class="layui-card-header">已发送人员列表</DIV>
                            <DIV class="layui-card-body">
                                <FORM class="layui-form" id="test" lay-filter="main-filter">
                                    <DIV class="tool">
                                        <DIV class="layui-form-item"><LABEL class="layui-form-label">发送日期</LABEL>
                                            <DIV class="layui-input-inline"><INPUT name="dateStr" class="layui-input"
                                                    id="date"></DIV><LABEL class="layui-form-label tele">手机号</LABEL>
                                            <DIV class="layui-input-inline tele"><INPUT name="mobileNo"
                                                    class="layui-input" id="mobileNo"></DIV><BUTTON class="layui-btn"
                                                type="button" lay-filter="queryOrder" lay-submit="">查询</BUTTON> <BUTTON
                                                class="layui-btn" id="btnprint" onclick="printMenu('orderTable')"
                                                type="button">打印</BUTTON>
                                            <BUTTON class="layui-btn" onclick="exportAll()" type="button">全部导出</BUTTON>
                                        </DIV>
                                    </DIV>
                                </FORM>
                                <TABLE id="orderTable" style="width: 100%;" lay-filter="order-filter"></TABLE>
                            </DIV>
                        </DIV>
                    </DIV>
                </DIV>
            </DIV>
        </DIV>
    </DIV>
    <DIV class="footer"></DIV>
    <SCRIPT src="../js/common.js"></SCRIPT>

    <SCRIPT type="text/javascript">
        var activityUid = " ";
        var icbcFlag = 0;
        $(document).ready(function () {
            $.ajax({
                type: "POST",
                url: "./getOrderReportInfos",// 请求分析数据
                data: { "activityUid": activityUid },
                datatype: "json",
                async: false,
                success: function (data) {
                    infos = data.data;
                    /* 	$("#allaccessNum")[0].innerText=data.data.allaccessNum;
                        $("#accessPersonNum")[0].innerText=data.data.accessPersonNum; */
                    $("#yearOrderNum")[0].innerText = data.data.yearOrderNum;
                    $("#monthOrderNum")[0].innerText = data.data.monthOrderNum;
                    $("#rule")[0].innerText = data.data.note;
                    $("#activityName")[0].innerText = data.data.activityName;
                }
            });
        });

        var form = layui.form;

        //表格
        var table = layui.table;
        var orderTable;
        if (icbcFlag == 1) {
            //订单详情表
            orderTable = table.render({
                elem: '#orderTable'
                , id: 'orderTable'
                , height: 600
                , url: './getTodayOrders?activityUid=' + activityUid + "&dateStr=" + today + "&timestamp=" + new Date().getMilliseconds()//数据接口
                , cols: [[ //表头
                    { field: 'orderId', title: '序号' }
                    , { field: 'userName', title: '姓名' }
                    , { field: 'moblieNo', title: '手机号' }
                    , { field: 'sendTime', title: '发送时间', templet: formatDatetime }
                    , { field: 'viewTime', title: '查看时间', templet: formatDatetime }
                ]]
            });
        }
        else {
            var tels = $(".tele");
            for (var i = 0; i < tels.length; i++) {
                tels[i].style.display = "none";
            }
            orderTable = table.render({
                elem: '#orderTable'
                , id: 'orderTable'
                , height: 600
                , url: './getTodayOrders?activityUid=' + activityUid + "&dateStr=" + today + "&timestamp=" + new Date().getMilliseconds()//数据接口
                , cols: [[ //表头
                    { field: 'orderId', title: '序号' }
                    , { field: 'userName', title: '姓名' }
                    , { field: 'moblieNo', title: '手机号' }
                    , { field: 'sendTime', title: '发送时间', templet: formatDatetime }
                    , { field: 'viewTime', title: '查看时间', templet: formatDatetime }
                ]]
            });
        }


        //查询指定日期所有订单
        form.on('submit(queryOrder)', function (data) {
            var info = data.field;
            info.activityUid = activityUid;
            //alert(JSON.stringify(info));
            orderTable.reload({
                url: './getTodayOrders',
                method: 'post',
                where: info
            });

        });



        function printMenu(layid) {
            var v = document.createElement("div");
            var f = ["<head>", "<style>", "body{font-size: 12px; color: #666;}", "table{width: 100%; border-collapse: collapse; border-spacing: 0;}", "th,td{line-height: 20px; padding: 9px 15px; border: 1px solid #ccc; text-align: left; font-size: 12px; color: #666;}", "a{color: #666; text-decoration:none;}", "*.layui-hide{display: none}", "</style>", "</head>"].join("");
            $(v).append($("[lay-id=\"" + layid + "\"]").find(".layui-table-header").html());
            $(v).find("tr").after($("[lay-id=\"" + layid + "\"] .layui-table-body.layui-table-main table").html()); $(v).find("th.layui-table-patch").remove();
            $(v).find(".layui-table-col-special").remove();
            var h = window.open("打印窗口", "_blank");
            h.document.write(f + $(v).prop("outerHTML"));
            h.document.close();
            h.print();
            h.close();
        }

        function edit() {
            window.location.href = './ordercfg?activityUid=' + activityUid;
        }

        //关闭对话框
        function cancelDiag() {
            layer.closeAll();

        }

        function exportAll() {
            var str = $("#date")[0].value;
            window.location.href = './exportAllOrders?activityUid=' + activityUid + "&dateStr=" + str + '';
        }

        function exportDish() {
            var str = $("#date1")[0].value;
            window.location.href = './exportAllDishes?activityUid=' + activityUid + "&dateStr=" + str + '';
        }

    </SCRIPT>
</BODY>

</HTML>