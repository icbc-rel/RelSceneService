<head>
    <title>贺卡列表</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script src="../js/jquery-3.2.1.min.js"></script>
    <SCRIPT src="../js/swiper.min.js"></SCRIPT>
    <script src="../css/layui/layui.js"></script>
    <link rel="stylesheet" href="../js/common.js" type="text/css" />
    <link rel="stylesheet" href="../css/common.css" type="text/css" />

    <link rel="stylesheet" href="../css/layui/css/layui.css" media="all">
    <LINK href="../css/swiper.min.css" rel="stylesheet">
    <link href="../css/index.css" rel="stylesheet" type="text/css" />

</head>

<body>


<div class="header">
    <div class="header_a">
        <div class="header_admin"></div>
        <!-- <div class="user"><span><%=session.getAttribute("adminName").toString()%></span></div> -->
    </div>
</div>

<div class="header">
    <div class="header_a">
        <div class="header_mp"></div>
        <!-- <div class="user"><span><%=session.getAttribute("mpName").toString()%></span></div> -->
    </div>
</div>

<DIV class="content2">
    <DIV class="vbm">
        <DIV class="klkl">
            <DIV class="main">
                <DIV class="layui-card">
                    <DIV class="layui-card-header">贺卡列表</DIV>
                    <DIV class="layui-card-body">
                        <FORM class="layui-form" id="test" lay-filter="main-filter">
                            <DIV class="tool">
                                <DIV class="layui-form-item"><LABEL class="layui-form-label">贺卡名称</LABEL>
                                    <DIV class="layui-input-inline"><INPUT name="activityName" class="layui-input"
                                                                           id="activityName"></DIV><BUTTON class="layui-btn" type="button"
                                                                                                           lay-filter="btnQuery" lay-submit="">查询</BUTTON>
                                </DIV>
                            </DIV>
                        </FORM>
                        <TABLE class="layui-table" id="demo" lay-filter="myfilter"></TABLE>
                        <SCRIPT id="barDemo" type="text/html">
                            <a class="layui-btn layui-btn-xs" lay-event="copy">拷贝链接</a>
                            <a class="layui-btn layui-btn-xs" lay-event="edit">查看配置</a>
                            <a class="layui-btn layui-btn-xs" lay-event="analysis">统计分析</a>
                            <a class="layui-btn layui-btn-xs" lay-event="delete">删除</a>
                        </SCRIPT>
                    </DIV>
                </DIV>
            </DIV>
        </DIV>
    </DIV>
</DIV>


<div class="footer"></div>
<script src="../js/index.js"></script>
<script src="../js/common.js"></script>
<script type="text/html" id="xuhao">
    {{d.LAY_TABLE_INDEX+1}}
</script>

<script>
    //表格
    layui.use('table', function () {
        var table = layui.table;
        var form = layui.form;
        //第一个实例
        mytable = table.render({
            id: 'demoReload'
            , elem: '#demo'
            , url: './getMyCard' //获取场景数据
            , method: "post"
            , height: 800
            , cols: [[ //表头
                { field: 'xuhao', width: '60', title: '序号', templet: '#xuhao', rowspan: 2 }
                , { field: 'cardName', width: '120', title: '贺卡名称', align: 'center' }
                , { field: 'cardType', width: '120', title: '贺卡类型', align: 'center' }
                , { field: 'sendTime', width: '160', title: '发送时间', align: 'center', templet: formatDatetime }
                , { fixed: 'right', width: '280', title: '操作', align: 'center', toolbar: '#barDemo' }
            ]]
        });

        //删除图片
        table.on('tool(myfilter)', function (obj) {
            var data = obj.data;
            if (obj.event == 'copy') {
                var text = data.activityUrl;
                var clip = window.clipboardData;
                if (!clip) {
                    clip = e.originalEvent.clipboardData;
                }
                clip.setData("Text", text);


            }
            else if (obj.event == 'edit') {
                if (data.relSceneUid == 'lottery') {
                    window.location.href = './lotterycfg?activityUid=' + data.activityUid;
                } if (data.relSceneUid == 'order') {
                    window.location.href = './ordercfg?activityUid=' + data.activityUid;
                } if (data.relSceneUid == 'meeting') {
                    window.location.href = './meetingCfg?activityUid=' + data.activityUid;
                } if (data.relSceneUid == 'asks') {
                    window.location.href = './asksCfg?activityUid=' + data.activityUid;
                }

            } else if (obj.event == 'analysis') {
                if (data.relSceneUid == 'lottery') {
                    window.location.href = './lotteryAnalysis?activityUid=' + data.activityUid;
                } if (data.relSceneUid == 'order') {
                    window.location.href = './orderAnalysis?activityUid=' + data.activityUid;
                } if (data.relSceneUid == 'meeting') {
                    window.location.href = './appoint?activityUid=' + data.activityUid;
                } if (data.relSceneUid == 'asks') {
                    window.location.href = './asks?activityUid=' + data.activityUid;
                }
            } else if (obj.event == "delete") {
                layer.confirm('确认删除活动:' + data.activityName, { icon: 3, title: '提示' }, function (index) {
                    $.ajax({
                        type: "GET",
                        url: "./delScene?activityUid=" + data.activityUid,
                        dataType: "json",
                        contentType: "application/json;charset=utf-8",
                        async: false,
                        complete: function (data) {
                            if (data.responseJSON.code == 0) {
                                mytable.reload();
                            } else {
                                alert("fail");
                            }
                        }
                    });
                    layer.close(index);
                });
            }
        });

        // //查询指定日期所有订单
        // form.on('submit(btnQuery)', function (data) {
        // 	var info = data.field;
        // 	mytable.reload({
        // 		url: './getMySencene',
        // 		method: 'post',
        // 		where: info
        // 	});

        // });
        function formatDatetime(value) {

            if (value.beginTime == undefined) {
                return "--";
            }
            return new Date(value.beginTime).format('yyyy-MM-dd hh:mm:ss');
        }



    });


</script>
</body>
